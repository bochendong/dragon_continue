"""
数据迁移脚本
将现有的角色档案数据迁移到数据库中
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(__file__)))

from character_database import CharacterDatabase

def migrate_character_data():
    """迁移角色数据到数据库"""
    
    # 创建数据库实例
    db = CharacterDatabase("dragon_characters.db")
    
    # 路明非数据
    print("正在迁移路明非数据...")
    char_id = db.add_character(
        name="路明非",
        background_story="路明非原本是中国普通高中生，性格内向，生活平淡。一次偶然的机会，他被卡塞尔学院录取，进入了一个充满龙族与混血种的神秘世界。在学院中，他逐渐发现自己身上隐藏的龙族血统，并与神秘的路鸣泽签订契约。从普通废柴成长为龙族战士，在一次次冒险中寻找自我价值和存在的意义。",
        character_arc="从普通高中生成长为龙族战士，寻找自我价值"
    )
    
    db.add_personality_traits(char_id, [
        "自卑但善良", "内心孤独", "有正义感", "喜欢吐槽",
        "表面普通内心强大", "对朋友忠诚", "有幽默感",
        "容易自我怀疑", "关键时刻勇敢", "有责任感"
    ])
    
    db.add_speech_patterns(char_id, [
        "善于自嘲，用幽默表达无奈", "内心独白丰富，喜欢吐槽",
        "口语化表达，符合高中生特点", "经常自我调侃和夸张比喻",
        "关键时刻话语简洁有力", "喜欢用网络用语和流行语",
        "有时会结巴或犹豫", "用轻松语气面对困难"
    ])
    
    db.add_memorable_quotes(char_id, [
        ("我们都是小怪兽，都将被正义的奥特曼杀死！", "经典台词", 10),
        ("人生在世很多事都不必想，很多账都算不过来，想屁！冲上去就好了！", "励志台词", 9),
        ("可你觉得孤独又能怎么样啊？你觉得孤独也不过是心情更差而已嘛。", "内心独白", 8),
        ("你不懂那种感觉，十几年了，谁也不觉得你有多重要，谁也不关心你今天干了什么，渐渐地你自己都觉得自己蛮多余的。", "情感表达", 7),
        ("我只是个普通人，为什么要让我面对这些？", "疑问", 6),
        ("有些事情，不是你想逃避就能逃避的。", "感悟", 5)
    ])
    
    # 路鸣泽数据
    print("正在迁移路鸣泽数据...")
    char_id = db.add_character(
        name="路鸣泽",
        background_story="路鸣泽是路明非的弟弟，但真实身份是龙王诺顿的弟弟康斯坦丁。他拥有完整的龙王血统和力量，但与路明非有着复杂的情感联系。作为龙王，他经历了数千年的孤独和痛苦，渴望被理解和接纳。他与路明非签订了契约，用自己的生命换取哥哥的力量，这种自我牺牲的爱让他成为了故事中最复杂和悲剧的角色。",
        character_arc="从神秘的存在到逐渐揭示身份，与哥哥的复杂关系"
    )
    
    db.add_personality_traits(char_id, [
        "神秘莫测", "内心复杂", "有强烈的保护欲", "孤独寂寞",
        "对哥哥有特殊感情", "力量强大但痛苦", "有时天真有时深沉",
        "渴望被理解", "有牺牲精神", "内心善良"
    ])
    
    db.add_speech_patterns(char_id, [
        "称呼路明非为'哥哥'", "声音轻柔，有时带着哀求", "话语简洁但有深意",
        "经常问'哥哥'问题", "有时会撒娇，有时很严肃", "喜欢说'和哥哥在一起'",
        "话语中带着孤独感", "善于诱导和试探", "语气中带有戏谑和深不可测"
    ])
    
    db.add_memorable_quotes(char_id, [
        ("哥哥，外面有很多人", "经典开场", 10),
        ("哥哥，我不害怕，和哥哥在一起，不害怕", "情感表达", 9),
        ("哥哥，你愿意和我做个交易吗？", "契约邀请", 8),
        ("你有完整的王之血统，却塞了一颗怯懦的人类之心在里面。你这样卑微的物种！怎敢跟我同样高贵？！", "愤怒表达", 7),
        ("吃掉我，什么样的牢笼哥哥都能冲破", "牺牲宣言", 9),
        ("哥哥，竖起战旗，吞噬世界的时候，你会吃掉我么？", "终极问题", 10),
        ("哥哥，再见", "告别", 8)
    ])
    
    # 凯撒数据
    print("正在迁移凯撒数据...")
    char_id = db.add_character(
        name="凯撒",
        background_story="凯撒·加图索出身于意大利显赫的加图索家族，是卡塞尔学院的学生会长。作为黑手党家族的继承人，他从小接受严格的贵族教育和战斗训练。虽然出身高贵，但他内心善良，有强烈的正义感。在学院中，他展现出了卓越的领导能力和个人魅力，深受同学们尊敬。他与诺诺有着复杂的感情关系，与路明非既是竞争对手也是朋友。",
        character_arc="从傲慢的贵族到成熟的领导者，学会真正的友谊"
    )
    
    db.add_personality_traits(char_id, [
        "自信张扬", "贵族气质", "领导力强", "内心善良",
        "有正义感", "表面傲慢内心温柔", "对朋友忠诚",
        "有责任感", "追求完美", "有时会吃醋"
    ])
    
    db.add_speech_patterns(char_id, [
        "正式礼貌的语调", "有时会显得傲慢", "关键时刻话语简洁有力",
        "喜欢用'我的朋友'称呼他人", "语调优雅，有贵族风范",
        "面对路明非时会有些挑衅", "对诺诺说话时温柔",
        "言语自信霸气，带有贵族气息", "善于激励和指挥他人"
    ])
    
    db.add_memorable_quotes(char_id, [
        ("我的朋友，你总是能给我惊喜", "友谊表达", 8),
        ("路明非，我们公平竞争", "竞争宣言", 7),
        ("诺诺，我会保护你", "爱情宣言", 9),
        ("真正的贵族不是血统，而是品格", "价值观", 8),
        ("朋友比敌人更珍贵", "友谊观", 7),
        ("我会用我的方式守护重要的人", "守护宣言", 8),
        ("你们可以挑战我，但我已经做准备好了嘲笑你们！", "霸气宣言", 9),
        ("挑战我的话，让正主来，你算个屁！", "傲慢表达", 8),
        ("敌人是什么？斩开就可以了！", "战斗宣言", 9)
    ])
    
    # 诺诺数据
    print("正在迁移诺诺数据...")
    char_id = db.add_character(
        name="诺诺",
        background_story="诺诺（陈墨瞳）是卡塞尔学院的学生，出身神秘，拥有强大的龙族血统。她性格独立坚强，聪明机智，有着不为人知的过去。作为学生会的重要成员，她与凯撒有着复杂的感情关系，但对路明非也有着特殊的关注和感情。她善于隐藏自己的真实想法，在关键时刻总是能够展现出惊人的智慧和勇气。她的身份和过去充满了谜团，是故事中最神秘的角色之一。",
        character_arc="从神秘的身份到逐渐揭示真相，与路明非的感情线"
    )
    
    db.add_personality_traits(char_id, [
        "神秘美丽", "性格独立", "有秘密", "内心复杂",
        "聪明机智", "有时温柔有时犀利", "对路明非有特殊感情",
        "有正义感", "善于隐藏真实想法", "有牺牲精神"
    ])
    
    db.add_speech_patterns(char_id, [
        "直接犀利的表达", "有时温柔有时冷漠", "话语有深意",
        "喜欢用反问句", "语调变化丰富", "对路明非说话时会有特殊语气",
        "关键时刻话语简洁有力", "言语直率爽朗，带有女性的坚韧和独立",
        "偶尔会有调皮和戏谑的成分"
    ])
    
    db.add_memorable_quotes(char_id, [
        ("路明非，你总是让我意外", "情感表达", 8),
        ("有些事情，不是你能承受的", "警告", 7),
        ("我会保护你，即使你不愿意", "保护宣言", 8),
        ("真正的爱情不是占有，而是守护", "爱情观", 9),
        ("路明非，你要变强", "期望", 7),
        ("有些秘密，暂时不能告诉你", "神秘", 6),
        ("你送过花没有？", "调侃", 5),
        ("可别以为女人是好甩掉的东西，她喜欢你，是会追着你到天涯海角的。", "爱情宣言", 8),
        ("喜欢一个人需要理由吗？需要吗？不需要吗？需要吗？不需要吗？", "哲学思考", 7),
        ("世界喜不喜欢你，只取决于你的朋友喜不喜欢你。", "友谊观", 8)
    ])
    
    # 楚子航数据
    print("正在迁移楚子航数据...")
    char_id = db.add_character(
        name="楚子航",
        background_story="楚子航是卡塞尔学院的学生，出身于武术世家，从小接受严格的剑道训练。他性格冷静理性，有着强烈的责任感和正义感。作为学院中的高手，他拥有强大的战斗力和高超的剑术。他与路明非是好友，经常在关键时刻保护路明非。他的过去与夏弥有着复杂的感情纠葛，这让他内心承受着巨大的痛苦。他一直在寻找内心的平静和真正的自我。",
        character_arc="从孤独的剑客到学会真正的友谊，寻找内心的平静"
    )
    
    db.add_personality_traits(char_id, [
        "冷静理性", "责任感强", "剑道高手", "内心温柔",
        "有正义感", "对朋友忠诚", "有时孤独", "有牺牲精神",
        "追求完美", "内心有创伤"
    ])
    
    db.add_speech_patterns(char_id, [
        "简洁有力的表达", "很少废话", "关键时刻有深度",
        "语调平静但有力", "喜欢用'嗯'回应", "对路明非说话时会有保护的语气",
        "话语中带着责任感", "言语冷静简洁，常以理性和责任感为主",
        "话语中透露出坚定和执着"
    ])
    
    db.add_memorable_quotes(char_id, [
        ("凡王之血，必以剑终。", "战斗宣言", 10),
        ("誓言是世界上最靠不住的东西，只有你对别人还有用的时候，别人才会遵守誓言。", "人生感悟", 9),
        ("路明非，我会保护你", "保护宣言", 8),
        ("剑道不是杀戮，而是守护", "剑道理念", 8),
        ("真正的强者不是没有恐惧，而是战胜恐惧", "强者理念", 7),
        ("朋友比剑更重要", "友谊观", 8),
        ("有些路，必须一个人走", "孤独感悟", 7),
        ("我会用我的剑守护重要的人", "守护宣言", 8),
        ("如果喜欢谁，就满世界去找她，别等她来找你，她可能也在等你……别让她等得对你失望了。", "爱情观", 9),
        ("你要去找他，要去救他，万山无阻。", "决心表达", 8)
    ])
    
    # 添加其他重要角色
    print("正在添加其他重要角色...")
    
    # 陈雯雯
    char_id = db.add_character(
        name="陈雯雯",
        background_story="路明非的高中同学，普通女孩，性格温柔善良。路明非对她有单方面的暗恋，但她与赵孟华是情侣关系。",
        character_arc="代表路明非青春期的纯真暗恋"
    )
    db.add_personality_traits(char_id, ["温柔善良", "普通女孩", "有主见", "对感情认真"])
    db.add_speech_patterns(char_id, ["温柔的语气", "关心他人", "有时会害羞"])
    db.add_memorable_quotes(char_id, [
        ("路明非，你要加油哦", "鼓励", 5),
        ("谢谢你一直以来的帮助", "感谢", 4)
    ])
    
    # 夏弥
    char_id = db.add_character(
        name="夏弥",
        background_story="楚子航的恋人，有着复杂的过去和身份。她的存在对楚子航产生了深远的影响，是楚子航内心创伤的重要来源。",
        character_arc="楚子航感情线的重要人物，复杂的过去"
    )
    db.add_personality_traits(char_id, ["神秘美丽", "性格复杂", "有秘密", "对楚子航有特殊感情"])
    db.add_speech_patterns(char_id, ["温柔而神秘", "话语有深意", "有时会显得悲伤"])
    db.add_memorable_quotes(char_id, [
        ("子航，你要好好的", "关心", 7),
        ("有些路，我们必须一个人走", "哲理", 6)
    ])
    
    # 添加角色关系
    print("正在添加角色关系...")
    
    # 路明非的关系
    db.add_relationship("路明非", "路鸣泽", "兄弟", "神秘的弟弟，关系复杂", 9)
    db.add_relationship("路明非", "楚子航", "朋友", "亦师亦友，保护对象", 8)
    db.add_relationship("路明非", "诺诺", "暗恋", "暗恋对象，神秘美丽", 7)
    db.add_relationship("路明非", "凯撒", "竞争", "竞争对手，贵族气质", 6)
    db.add_relationship("路明非", "陈雯雯", "暗恋", "高中同学，暗恋对象", 5)
    
    # 路鸣泽的关系
    db.add_relationship("路鸣泽", "路明非", "兄弟", "哥哥，最重要的人", 10)
    
    # 凯撒的关系
    db.add_relationship("凯撒", "诺诺", "恋人", "未婚妻，深爱的人", 9)
    db.add_relationship("凯撒", "路明非", "竞争", "竞争对手，但也是朋友", 7)
    db.add_relationship("凯撒", "楚子航", "对手", "对手兼朋友", 8)
    
    # 诺诺的关系
    db.add_relationship("诺诺", "路明非", "关注", "被暗恋，有特殊感情", 7)
    db.add_relationship("诺诺", "凯撒", "恋人", "未婚夫，复杂关系", 8)
    db.add_relationship("诺诺", "楚子航", "朋友", "朋友，相互理解", 6)
    
    # 楚子航的关系
    db.add_relationship("楚子航", "路明非", "保护", "保护对象，朋友", 8)
    db.add_relationship("楚子航", "夏弥", "恋人", "感情线，复杂的过去", 9)
    db.add_relationship("楚子航", "凯撒", "对手", "对手兼朋友", 7)
    
    print("数据迁移完成！")
    
    # 显示统计信息
    stats = db.get_database_stats()
    print(f"\n数据库统计信息:")
    print(f"- 角色数量: {stats['character_count']}")
    print(f"- 关系数量: {stats['relationship_count']}")
    print(f"- 台词数量: {stats['quote_count']}")
    print(f"- 平均台词评分: {stats['average_quote_score']}")
    print(f"- 数据库大小: {stats['database_size']} bytes")
    
    return db

if __name__ == "__main__":
    db = migrate_character_data()
    
    # 测试查询功能
    print("\n=== 测试查询功能 ===")
    
    # 获取路明非档案
    lumingfei = db.get_character_profile("路明非")
    print(f"路明非档案: {lumingfei['name']}")
    print(f"性格特征: {lumingfei['personality_traits'][:3]}...")
    print(f"经典台词: {lumingfei['memorable_quotes'][0]['quote']}")
    
    # 获取角色关系
    relationships = db.get_character_relationships("路明非")
    print(f"路明非的关系: {list(relationships.keys())}")
    
    # 搜索功能
    search_results = db.search_characters("哥哥")
    print(f"搜索'哥哥'的结果: {[r['name'] for r in search_results]}")
